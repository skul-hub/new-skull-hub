<!DOCTYPE html>
<html>
<head>
<title>Kelola Produk</title>
<link rel="stylesheet" href="../style.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="../supabase.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async()=>{
    if(!localStorage.getItem("admin")){alert("Login admin dulu"); window.location.href="../index.html";}
    const container=document.getElementById("productTable");
    async function fetchProducts(){
        const {data:products}=await supabase.from("products").select("*");
        let html=`<table class="table"><tr><th>Nama</th><th>Harga</th><th>Gambar</th><th>Aksi</th></tr>`;
        products.forEach(p=>{html+=`<tr>
            <td>${p.name}</td>
            <td>${p.price}</td>
            <td><img src="${p.image}" width="50"/></td>
            <td><button onclick="edit(${p.id})">Edit</button> <button onclick="hapus(${p.id})">Hapus</button></td>
        </tr>`;});
        html+="</table>";
        container.innerHTML=html;
    }
    fetchProducts();

    window.tambahProduk=async()=>{
        const n=prompt("Nama produk"); const pr=parseInt(prompt("Harga")); const img=prompt("URL Gambar");
        if(!n||!pr) return alert("Nama & harga wajib");
        await supabase.from("products").insert([{name:n,price:pr,image:img}]); fetchProducts();
    }
    window.edit=async(id)=>{
        const n=prompt("Nama baru"); const pr=parseInt(prompt("Harga baru")); const img=prompt("URL Gambar baru");
        if(!n||!pr) return alert("Nama & harga wajib");
        await supabase.from("products").update({name:n,price:pr,image:img}).eq("id",id); fetchProducts();
    }
    window.hapus=async(id)=>{if(confirm("Yakin hapus?")){await supabase.from("products").delete().eq("id",id); fetchProducts();}};
});
</script>
</head>
<body>
<div class="navbar"></div>
<h2>Kelola Produk</h2>
<button onclick="tambahProduk()">Tambah Produk</button>
<div id="productTable"></div>
<footer>@2025SKULLHOSTING - StoreSkull</footer>
</body>
</html>
